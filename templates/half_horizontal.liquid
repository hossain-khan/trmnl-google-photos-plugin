<div class="layout" style="position: relative;">
  {% if photo_url and photo_url != '' %}
  <div class="flex flex--row gap--medium md:gap--large portrait:flex--col portrait:gap--small flex--center-y h--full">
    <!-- Photo Display -->
    <div class="flex flex--center-x flex--center-y h--full" style="flex: 1;">
      {% render "photo_display", photo_url: photo_url, caption: caption %}
    </div>
    
    <!-- Caption (if available) -->
    {% if caption %}
    <div class="flex flex--col gap--xsmall md:gap--small w--40 md:w--52 portrait:w--full">
      <span class="description md:title md:title--small lg:title lg:title--medium" data-clamp="4">{{ caption }}</span>
      {% if photo_count and photo_count > 0 %}
      <span class="label label--small md:description">{{ photo_count }} photos in album</span>
      {% endif %}
    </div>
    {% endif %}
  </div>
  {% else %}
  <!-- No Photo Available -->
  {% render "error_state", size: "half" %}
  {% endif %}
  
  <!-- Year Display (Bottom Right) -->
  {% if image_update_date and trmnl.plugin_settings.custom_fields_values.show_year != "false" %}
  <!-- Note: TRMNL Framework doesn't provide positioning utilities (absolute/relative),
       so inline styles are used for overlay positioning -->
  <div style="position: absolute; bottom: 0px; right: 12px;">
    <span class="value value--large text-stroke text-stroke--large">{{ image_update_date | date: "%Y" }}</span>
  </div>
  {% endif %}
</div>

<div class="title_bar">
  <img src="{{ icon_google_photos }}" class="icon h--5" alt="Google Photos">
  <span class="title md:title--large">{% if trmnl.plugin_settings.custom_fields_values.custom_title and trmnl.plugin_settings.custom_fields_values.custom_title != '' %}{{ trmnl.plugin_settings.custom_fields_values.custom_title }}{% else %}{{ trmnl.plugin_settings.instance_name }}{% endif %}</span>  <!-- When show_metadata is enabled: photo count is merged into instance metadata (e.g., "2 years ago • 12MP • 142 photos")
       When show_metadata is disabled: photo count displays as separate label badge -->  {% unless trmnl.plugin_settings.custom_fields_values.show_metadata == "false" %}
  <span class="instance">
    {% if relative_date %}{{ relative_date }}{% endif %}
    {% if megapixels %} • {{ megapixels }}MP{% endif %}
    {% if photo_count and photo_count > 0 %} • {{ photo_count }} {% if photo_count == 1 %}photo{% else %}photos{% endif %}{% endif %}
  </span>
  {% else %}
  {% if photo_count and photo_count > 0 %}
  <span class="label">{{ photo_count }} {% if photo_count == 1 %}photo{% else %}photos{% endif %}</span>
  {% endif %}
  {% endunless %}
</div>
