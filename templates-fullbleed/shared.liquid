{% comment %}
  Shared template for Google Photos plugin
  This file contains reusable assets and utilities for all layout templates:
  - Google Photos icon (base64-encoded)
  - Brightness mapping utilities for adaptive backgrounds
  - Reusable error state template
  - Photo data is provided by backend API endpoint (/api/photo)
{% endcomment %}

{% comment %}
  Google Photos icon for title bars (59x59px, base64-encoded PNG)
  Usage in templates:
    <img src="{{ icon_google_photos }}" class="icon" alt="Google Photos">
  
  This icon is a stylized version of the Google Photos logo optimized for e-ink displays:
  - 59x59px resolution (optimal for TRMNL title bars)
  - PNG format with transparency
  - Base64-encoded for direct embedding
{% endcomment %}
{%- capture icon_google_photos -%}
data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAA8CAQAAACQ9RH5AAAAAXNSR0IArs4c6QAAAAlwSFlzAAALEwAACxMBAJqcGAAABThJREFUeNrFmM9vG0UUxzc/mtRNuZTEm+x+36xdXH6lUYl6zCXcyqVIUMgpEjQnxAH+AvgDeqiqikiFG0hpkgvlBHe49BACVKFNWlSRNE7ASkqapPZ6HT/8ZDsjZHdnN2AzX8kHz+x85r15895orCO2TvnBNWJsYRFfuR87o9X/M71WS1uXZdlJbClGoFixLMCdxbh0pY63GJy2sU6MAgL4YGLF8N1pu8+yhntabHENzGCUUCBf4FhEptLf3UJw0ka2Bq7Lp6JirDsvyYhWg30wtA7wVDFW3Ocl0NoJFu17TPOWtI72gg/E4e6ldoNFBcX4xeoWdDvBIl8xvfl/gPOKMRN/Wllp56E6KooLDoixZvfFsFkwxv/N4HJFTGc1OCJ04CRG8AZN0AQu0Fm7T/dHBLNENi5EOc31IV100b2JNbCqCYxVzNBFgckoI1iH14QZ3FGdFm/hZ4GROCsgn3wE1QIgB8S9dIjuNFqswSYsTtGsAFBAHiWUofcrQB6+9NE8Tom9/5WrBZvBssfI66TfoAJ8j/EAZ6o1N3304NLYIQ+PFNMOOFRl7CumzVRKPhsc+FfHSToyvfhRMZ4YsDo13BGLycH6kRKIBtNVj7ErFoVDddjgc8tyKMTiQoSU6YwS62AyS0YSu+fOH8O2gBt7kY9UJGheSVBxDPCBOHK4BzliFBr7xV68bcCq0wiMTm6suIw/MY67qhn4icc0Z7wI0IeKyQfHBpdxhRY0uL542vEY9yJcfWhOMRVjQDXie1r656LJx57HWI102XN/JcYB+Ahap00Jy9pSfDmOHuO2Om3ESsM2FSUnRVRB7s+QM1DLchJqCFBWnGJiXBcnOycyvcM9YapsA7FiiizFImKdFsG1GTZoGiMxLhq4hi08QtagdWSxjRzu0gIt0SZ8lOtJlB7iW3yCcacfCTvpkDeUGvSGmkv6yEnblrS0bSftZNJ+ltL24AA5Dp0/Ntzjvo4r9AOyyNfAEpiPsYoV3McacsjRpkEb2KAd3LCiN/c1zCCHmqO1q1HfhBgbRiynrStUHc4Jy0ICX9SjQVdc7IMPXV6KrECSjNFOqUP0Au4IVCK4orqlj+lhvKOorwi0EAHrvUIbimtI/Tnjd3ynGEFssO8xvgzFyrOCncRvMj0EqlUmxgo+Jb3TUVUCK8ZH4RciCalvFKPU4NCSYtzHOP5QDD8WWCrXlnsuhIuEZdFlYmrmTgGvOf00nWLsxsnyssPuzRDscI+gsfiMElIiRg4JjBBTjOpGPomHxg32upPa3mZgO2lZuO6xTifhkgBV7H4mJTN0f2lWh1UjmDYcsiynH7c9xlOUzViJZ1rof07CNiSeU4O4p0OnCXjTG5KxOINVqcuGgxUgUFKrXxZvhjpajWGXmIrh4IGTlZGvYlkxBN7MP2UEVCRWcgBHZG5D4nDfRXWHQ8FSeeVyj6+JVXW8T0WxDyUBwkdQ67mVGpRabcxYmKIIYMFWbaD3sNhYLFQV+hNdljEaawaXTBbXY0IW4E7SHJaxh3o52cOyO+tOCtDwyhnT1frdsqtqtwSlM1b5dgpT7jvOWNKuR43hHqaDy9HBZQDrpINE89lklLnp47RsPk4NU3ZlepFAInVchESmt9FSc4HQCcQMjt/MKbNFYHORaB9Yl8X3STBB28B6n3FLbEa5nWCJbak+DxQj3zawRrsvIitoHLQJrIMslcKiJ7gCyu0CS+sWy+kqcbX0URElASPbUrB+v3RGaQ6l+oMjMf3VcrB+t/XS9AHNYkmyOG7Iko76Bv8323ftNhD5Mp0AAAAASUVORK5CYII=
{%- endcapture -%}

{% comment %}
  ====================================================================================
  BRIGHTNESS MAPPING UTILITIES
  ====================================================================================
  Maps image brightness scores (0-100 scale) to TRMNL Framework background colors
  for adaptive background styling in full-screen image layouts.
  
  Available from API response:
  - brightness_score: Overall image brightness (0-100)
  - edge_brightness_score: Brightness at edges (0-100) - better for detecting light backgrounds
  
  TRMNL Framework background classes:
  - bg--white (100% brightness)
  - bg--gray-25 (75% brightness)
  - bg--gray-50 (50% brightness)
  - bg--gray-75 (25% brightness)
  - bg--black (0% brightness)
{% endcomment %}

{% comment %}
  Map brightness score to TRMNL background color class
  Uses edge_brightness_score if available (better for light backgrounds behind images),
  falls back to overall brightness_score
  
  Parameters:
  - brightness_overall: Overall image brightness (0-100)
  - brightness_edge: Edge brightness for light background detection (0-100)
  
  Returns: TRMNL Framework background class (e.g., "bg--white", "bg--gray-50", "bg--black")
  
  Logic:
  - Use edge_brightness_score if available (better for detecting light edges/backgrounds)
  - If edges are bright (>75), use white background to blend with light image edges
  - Otherwise use overall brightness to determine best background match
  - Thresholds: 75=white, 50=gray-25, 25=gray-50, else=black
{% endcomment %}
{% liquid
  assign edge_brightness = edge_brightness_score | default: brightness_score | default: 50
  assign overall_brightness = brightness_score | default: 50
  
  if edge_brightness > 75
    assign bg_class = 'bg--white'
  elsif edge_brightness > 50
    assign bg_class = 'bg--gray-25'
  elsif edge_brightness > 25
    assign bg_class = 'bg--gray-50'
  else
    assign bg_class = 'bg--gray-75'
  endif
%}

{% comment %}
  Photo data is provided by the backend API endpoint (/api/photo)
  The following variables are available from the JSON response:
  
  - photo_url: Optimized full-resolution photo URL (1040Ã—780 for TRMNL X)
  - thumbnail_url: Lower resolution version (400Ã—300, optional)
  - caption: Photo caption/description (may be empty)
  - timestamp: When photo was taken/updated (ISO 8601 format)
  - album_name: Name of the source album
  - photo_count: Total number of photos in album
  - brightness_score: Overall image brightness (0-100, optional)
  - edge_brightness_score: Edge brightness for light background detection (0-100, optional)
{% endcomment %}

{% comment %}
  ====================================================================================
  REUSABLE LIQUID TEMPLATES
  ====================================================================================
  These templates follow TRMNL best practices for DRY (Don't Repeat Yourself) code.
  Reference: https://docs.usetrmnl.com/go/reusing-markup
{% endcomment %}

{% comment %}
  Error State Template
  ----------------------
  Displays a helpful error message when no photo is available (plugin not configured).
  Provides clear instructions to guide users to configure their shared album URL.
  
  This template is used in full-bleed full-screen image layouts when photo_url is empty.
  
  Usage in full-screen templates:
    {% if photo_url and photo_url != '' %}
      <!-- Show photo -->
    {% else %}
      <div class="flex flex--col flex--center-x flex--center-y gap--medium h--full">
        <div class="value value--large text--center">ðŸ“·</div>
        <div class="title title--medium text--center">No Photos Available</div>
        <div class="description text--center">
          Please configure your Google Photos shared album URL in the plugin settings.
        </div>
      </div>
    {% endif %}
{% endcomment %}
